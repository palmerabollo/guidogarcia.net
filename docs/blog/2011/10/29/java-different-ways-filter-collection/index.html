<!DOCTYPE html><html><head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="Call me Sam, a theme for Hugo.">

<meta name="twitter:card" content="summary">
<meta name="twitter:domain" content="https://guidogarcia.net">

<meta name="twitter:image" content="https://guidogarcia.net/tn.png">
<meta name="twitter:title" property="og:title" itemprop="title name" content="Call me Guido">
<meta name="twitter:description" property="og:description" itemprop="description" content="Call me Sam, a theme for Hugo.">
<meta name="og:type" content="website">
<meta name="og:url" content="https://guidogarcia.net">
<meta name="og:image" itemprop="image primaryImageOfPage" content="https://guidogarcia.net/tn.png">

<link rel="shortcut icon" href="https://guidogarcia.net/sam.ico" id="favicon">
<link rel="stylesheet" href="https://guidogarcia.net/css/style.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>







<title>

Java : different ways to filter a Collection

</title></head><body>
<div class="wrap">
<div class="section" id="title">Java : different ways to filter a Collection</div>

<div class="section" id="content">

<p>Imagine we have a simple Java class:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> age<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">private</span> Gender sex<span style="color:#f92672">;</span>

  <span style="color:#75715e">// constructor, getters &amp; setters
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

<span style="color:#66d9ef">enum</span> Gender <span style="color:#f92672">{</span> MALE<span style="color:#f92672">,</span> FEMALE <span style="color:#f92672">};</span></code></pre></div>

<p>And that you have a <code>Collection</code> of <code>Person</code> objects, such as the following one:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Person p1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person<span style="color:#f92672">(</span>35<span style="color:#f92672">,</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">MALE</span><span style="color:#f92672">);</span>
Person p2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person<span style="color:#f92672">(</span>30<span style="color:#f92672">,</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">MALE</span><span style="color:#f92672">);</span>
Person p3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person<span style="color:#f92672">(</span>25<span style="color:#f92672">,</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">FEMALE</span><span style="color:#f92672">);</span>
Person p4 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person<span style="color:#f92672">(</span>15<span style="color:#f92672">,</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">FEMALE</span><span style="color:#f92672">);</span>

List<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> people <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span>p1<span style="color:#f92672">,</span>p2<span style="color:#f92672">,</span>p3<span style="color:#f92672">,</span>p4<span style="color:#f92672">);</span></code></pre></div>

<p>How would you create a new <code>Collection</code> containing only men over 21?</p>

<h3 id="use-plain-java-like-tough-people-do">Use plain Java, like tough people do</h3>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;();</span>
<span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Person person <span style="color:#f92672">:</span> people<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>person<span style="color:#f92672">.</span><span style="color:#a6e22e">getAge</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 21 <span style="color:#f92672">&amp;&amp;</span> person<span style="color:#f92672">.</span><span style="color:#a6e22e">getGender</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">MALE</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    result<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>person<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">//</span> now result contains the filtered collection</code></pre></div>

<h3 id="filtering-by-predicate">Filtering by predicate</h3>

<p>The second option is what <a href="http://commons.apache.org/collections/">Commons Collections</a> and <a href="http://code.google.com/p/guava-libraries/">Guava</a> propose, and that I think should have been part of the Java core at least since Java 5.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Predicate</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>T type<span style="color:#f92672">);</span> <span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> Collection<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> col<span style="color:#f92672">,</span> Predicate<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> predicate<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  Collection<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;();</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>T element: col<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>predicate<span style="color:#f92672">.</span><span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>element<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
      result<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>element<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span></code></pre></div>

<p>It remembers me the visitor pattern. With this approach in mind, you can define a set of predicates:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Predicate<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> validPersonPredicate <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Predicate<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>Person person<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> person<span style="color:#f92672">.</span><span style="color:#a6e22e">getAge</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 21 <span style="color:#f92672">&amp;&amp;</span> person<span style="color:#f92672">.</span><span style="color:#a6e22e">getGender</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">MALE</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">};</span>

Collection<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> filter<span style="color:#f92672">(</span>people<span style="color:#f92672">,</span> validPersonPredicate<span style="color:#f92672">);</span></code></pre></div>

<p>I find it very similar to Python&rsquo;s <code>filter()</code> function, but more verbose due to Java&rsquo;s nature.</p>

<p>This way your code becomes cleaner, and you can combine fine-grained reusable predicates. As a future line of work, it would be interesting to define a <a href="http://martinfowler.com/bliki/FluentInterface.html">fluent interface</a> that allows chaining of several predicates in a more natural way.</p>

<h3 id="jsr-335-project-lambda-and-lambdaj">JSR 335, Project Lambda and lambdaj</h3>

<p><a href="http://jcp.org/en/jsr/detail?id=335">JSR 335</a> (Lambda Expressions for the Java Programming Language) is part of JSR 337 (Java SE 8), which is scheduled for release in late 2012.</p>

<p>Lambda syntax is <a href="http://mail.openjdk.java.net/pipermail/lambda-dev/2011-September/003936.html">already decided</a> (it is similar to C# and Scala) and what I hope is to see something similar to this kind of filtering, method chaining included:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    Collection<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> people
        <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>p <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">age</span> <span style="color:#f92672">&gt;</span> 21 <span style="color:#f92672">})</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>p <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">gender</span> <span style="color:#f92672">==</span> Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">MALE</span> <span style="color:#f92672">});</span></code></pre></div>

<p>If you can not wait and need to start using that kind of syntax today, I recommend the <a href="http://code.google.com/p/lambdaj/">lambdaj library</a>, it is not the same but it is handy in some cases:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    Collection<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> with<span style="color:#f92672">(</span>people<span style="color:#f92672">).</span><span style="color:#a6e22e">clone</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">retain</span><span style="color:#f92672">(</span>having<span style="color:#f92672">(</span>on<span style="color:#f92672">(</span>Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getAge</span><span style="color:#f92672">(),</span> greaterThan<span style="color:#f92672">(</span>21<span style="color:#f92672">)))</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">retain</span><span style="color:#f92672">(</span>having<span style="color:#f92672">(</span>on<span style="color:#f92672">(</span>Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getGender</span><span style="color:#f92672">(),</span> equals<span style="color:#f92672">(</span>Gender<span style="color:#f92672">.</span><span style="color:#a6e22e">MALE</span><span style="color:#f92672">)));</span></code></pre></div>

<p>I have not tried the last snippet but you get the idea. Notice you have to call <code>clone()</code> if you want to leave the original collection unchanged.</p>

<h2 id="a-small-benchmark">A small benchmark</h2>

<p>As a second line of work, a comparison between the three alternatives is still to be done. I suppose the use of predicates is cleaner at the cost of a lower performance.</p>

<p>Comments are open.</p>
</div>


<div class="section bottom-menu"><hr/><p>


<a href="/posts">Hello. Call me Guido</a>


&#183; <a href="https://twitter.com/palmerabollo">Twitter</a>
&#183; <a href="http://bot.guidogarcia.net/">My bot (alpha)</a>

&#183; <a href="https://guidogarcia.net"></a></p></div>


<div class="section footer"></div>
</div>
</body></html>